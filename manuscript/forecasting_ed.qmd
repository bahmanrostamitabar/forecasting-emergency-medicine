---
title: Forecasting
format:
  elsevier-pdf:
    keep-tex: true
    journal:
      name: Annals of Emergency Medicine
      formatting: preprint
      model: 3p
      cite-style: authoryear
  elsevier-html: 
    toc: true
author:
  - name: Bahman Rostami-Tabar
    email: rostami-tabarb@cardiff.ac.uk
    affiliations: 
        - id: carbs
          name: Cardiff University
          department: Cardiff Business School
          country: United Kingdom
          postal-code: CF10 3EU
    attributes:
        corresponding: true
    note: This is the first author footnote.
  - name: Rob J. Hyndman
    email: Rob.Hyndman@monash.edu
    affiliations:
        - id: monash
          name: Monash University
          department: Department of Econometrics and Business Statistics
          country: Australia
          postal-code: VIC 3800
abstract: |
  This is the abstract. An accurate demand forecasting is crucial in Emergency medicine to depict various courses of action that can result in massive savings in terms of patient lives. Inability to match the staff with the demand results in an overcrowding care system which is a serious problem causing challenging situations on patient flow. Also, it is related with increasing length of stay, low patient satisfaction, increasing health care costs, inaccuracy in electronic medical record, and reported waiting times.
keywords: [Forecasting, Ambulance, Hierarchical structure]
bibliography: mybibfile.bib
---


```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, message = FALSE, warning = FALSE)
# Make sure you have the latest versions of rmarkdown and rticle
library(tidyverse)
library(lubridate)
library(patchwork)
library(tsibble)
library(kableExtra)
library(fable)
library(ggthemes)
library(readxl)
library(here)
```

```{r, include=FALSE, cache=FALSE}

```

# Introduction

An accurate demand forecasting is crucial in Emergency medicine to depict various courses of action that can result in massive savings in terms of patient lives. Inability to match the staff with the demand results in an overcrowding care system which is a serious problem causing challenging situations on patient flow. Also, it is related with increasing length of stay, low patient satisfaction, increasing health care costs, inaccuracy in electronic medical record, and reported waiting times.without incurring last-minute expenses, such as overtime or supplemental staffing [Reference].

An accurate forecasting of the daily demand enables managers to match staff to meet anticipated patients, reconfigure units and redeploy staff and vehicles. This will have many advantages for patients, staff and the quality of healthcare services provided.

 The ability to accurately forecast the demand of future health services is critical for planning decisions aimed at improving the quality of service delivery in the health care. Forecasting has been used in various fields of healthcare to inform planning decisions at the strategic, tactical and operational levels. There is at least one or multiple reasons why we need to produce a forecast. Most often reasons determine clearly what to forecast and which level of forecast granularities are required. There are typically some planning process at strategic(long-term) level such as dimensioning resource capacities and budgeting; tactical(medium-term) level such as temporary capacity expansions, staff-shift scheduling, and inventory control; and operational(short-term) level such as planning rosters for staff and allocate resources and medical item distribution. Each planning level will typically have different forecasting needs in terms of granularity and horizon (how far into the future do we forecast). A natural question that arise from these examples is how to generate forecasts to support planning decisions at multiple granularities and horizons. In order to answer this question, we first need to understand some fundamental aspects of forecasting in healthcare:
 
Daily forecasts are required to inform the short-term planning for the current and the upcoming shifts of the day. This involves the decision making related to the execution of the delivery process for various health care services such as Ambulatory ,Emergency. Daily forecasts are important at various levels:

- **Nature of incidents**

- **Category: Red, Amber, Green**

- **Health board**

- **Country level**


Implementing and sustaining improvements in hospital-wide flow requires alignment, cooperation, and coordination between hospital units and departments. Without effective executive oversight and collaboration, teams operate in isolation from one another and the aggregated impact of their efforts is limited. In many cases, this isolation leads to duplicative work, rework, or work that runs counter to overall goals to improve hospital-wide patient flow
 
The combination of demand forecast, incidents being attended, resource availability and delays at hospitals, provide information on the state of the unscheduled care system across the emergency medicine services. Having this full picture enables the delivery managers to focus on the areas that require intervention to enable the most effective delivery of the service to the patients. 

<!-- An accurate demand forecast by hour of the day enables planners to match staff to meet anticipated patients, reconfigure units and redeploy staff. This will have many advantages for both patients, staff and the quality of provided services. Hourly forecasts are required to inform the short-term operational planning for the current and the upcoming shifts of the day. This involves the short-term decision making related to the execution of the delivery process in ED. The combination of an hourly forecast demand, current staff being occupied, resource availability and waiting times at ED, provide information on the state of the unscheduled care system across the service. Having this full picture enables the delivery managers to focus on the areas that require intervention to enable the most effective delivery of the service to the patients. Moreover, there are often unplanned events, such as walk-in patients, extended consultation times, during a day or a week. Staff capacities may be adjusted based on the predicted demand fluctuations by using part-time, on-call nurses, staff overtime and voluntary absenteeism. That may also require to adjust the scheduling. -->

Despite a large number of studies dedicated to forecasting in healthcare[ref], this ques-
tion unanswered in healthcare forecasting. Almost all studies assume that the level of
data granularity matches with the level of forecast requirement, e.g. daily series is used
to generate daily forecast. Moreover, in the presence of the high data granularity, the
recommendation is to first aggregate the data into a requested forecast granularity level
and then generate the forecast(Goodwin, 2018). However, there is no empirical evidence
to support this claim

# Research background {#lit}

Table @tbl-lit summarise studies on forecasting in emergency and urgent care.


```{r}
#| label: tbl-lit
#| tbl-cap: "summary of literature review"
lit <- readxl::read_xlsx(here("data/literature.xlsx"))
 lit %>% kable() %>%  kableExtra::kable_styling(latex_options = c("scale_down","hold_position")) %>% column_spec(5,"15em")
```

<!--
Is there any study using grouped time series in urgent and emergency care?
-->


<!--
Using models for count time series in urgent and emergency care!
-->


Focus on the ambulance services!


@gijo2016sarima generated a time series model to forecast the daily and hourly call volume at all centre handling emergency ambulance services.  Since historical data showed seasonality, SARIMA models were investigated. Regarding the daily model, the authors generated a SARIMA model, which, however, resulted in the forecast error (MMSE) that significantly increased when the lead time exceeded 8 days. On the other hand, the SARIMA model proposed to forecast the log-calls an hourly basis. This model was found to fit well the model both for shorter and longer lead times. 


Forecasting at the daily level of granularity is generally use for roaster planing and deciding when to contact staff on call for instance. @luo2017hospital use a combination of seasonal ARIMA (SARIMA) and a single exponential smoothing (SES) model to forecast daily outpatient visits 1 week ahead.They indicate that using combinatorial model can be more effective than each model separately. @whitt2019forecasting examine several alternative models to forecast the total daily arrival for 1-7 days ahead, including a linear regression based on calendar and weather variables, seasonal autoregressive integrated moving average with exogenous regressors (SARIMAX) and the multilayer perceptron (MLP) model. Using a daily ED admission for 3 years, they show that SARIMAX provides the most accurate daily forecast by MSE measure. @marcilio2013forecasting compare the forecast accuracy of the Generalised Linear Model (GLM), Generalised Estimating Equations (GEE), and Seasonal Autoregressive Integrated Moving Average (SARIMA) methods using total daily patient visits to an ED using MAPE. They conclud that GLM and GEE models provide more accurate forecasts than SARIMA model. @rostami2020anticipating propose a model to forecast daily ED attendance with consideration of different types of holidays, weekday effects, auto-regressive effects, long-term trends and date effects. They provide probabilistic forecasts to quantify uncertainties in future ED attendance and they show that the proposed model outperforms three time series techniques including 1) Naive, 2) AutoRegressive, AR(p), 3)  exponential smoothing state space model (ETS) and a regression model without considering special events as alternatives. @zhou2018time SARIMA, NARNN and the hybrid SARIMA-NARNN to forecast the daily number of new admission inpatients. The root mean square error (RMSE), mean absolute error (MAE) and mean absolute percentage error (MAPE) were used to compare the forecasting performance among the three models. They show that NARNN model outperforms the others. @sun2009forecasting use SARIMA model to forecast daily patient volume for each patient acuity level. MAPE is used to choose the best-fit model. They fitted separate ARIMA models to the three categories of acuity and overall data. They conclude that the ARIMA model is effective for both short term (weekly) and long term (three months) forecast horizons. Moreover, they observe that the impact of weather is not significant. @zinouri2018modelling use SARIMA to develop a statistical prediction model that provides short-term forecasts of daily surgical demand.  Our results suggest that the proposed SARIMA model can be useful for estimating surgical case volumes 2–4 weeks prior to the day of surgery, which can support robust and reliable staff schedules.
@moustris2012seven use Artificial Neural Network (ANN) models to forecast the total weekly(7 days) number of Childhood Asthma Admission. Three different ANN models were developed
and trained to forecast the admission of different age subgroups 
and for the whole study population.
@mccoy2018assessment compare SARIMA, Prophet and Snaive methods for prediction 365 days of hospital discharge using a daily hospital discharge volumes at 2 large, New England academic medical centers. They show that Prophet model outperforms SARIMA and Snaive.


@khaldi2019forecasting investigate the combination of the Artificial Neural Networks (ANNs) with a signal decomposition technique named Ensemble Empirical Mode decomposition (EEMD), to make one step ahead weekly forecasting of patients arrivals to ED. using seven years of weekly demand. The results of the proposed model were compared against ANN without signal decomposition, ANN with Discrete wavelet Transform (DWT). The results show that the combined forecasts outperform the benchmarking models.

@steins2019forecasting aimed to develop a forecasting model for predicting the number of ambulance services calls per hour and geographical areas, to support managers in decisions-making and to investigate which ones were the factors that affected the number of calls.
Data collected consisted of a time and location of historical ambulance call data for three counties in Sweden and a list of explanatory factors of the area, such as socioeconomic and geographic. 
In order to deal with large number of zeros in the data, authors developed zero-inflated Poisson (ZIP) and zero-inflated negative binomial (ZINB) regression models. These were then compared to the currently existing forecasting system, based on moving average with seasonality weights, using ME, MAE and RMSE. Firstly, the factors affecting the number of ambulance calls were found to be the following: population in different age groups, median income, length of road, number of nightlife spots (the number of restaurants), day of the week and hour of the day. Secondly, it was found that the older population (65-100) generated more ambulance calls and that ZIP model performs better than the current model. However, the improvement provided by the more advance model was not much greater than the one provided by the existing model. Authors suggested that it could be because the population, which was used as an independent variable in both models, was so dominant compared to the other factors. 
Moreover, both models either underestimated or overestimated the number of calls. Authors suggested that the inability to capture a positive trend resulted in underestimation, and the opposite was due to a negative trend. Therefore, authors recommended that further research should add certain temporal variables able to capture the trend.


# Data

Operations Department and I suppose it's split into three different categories.  You've got... you've got Response which is the ambulances.  You've got the Control which is the people who take the telephone calls.  And then you've got Resilience which are the things that people like have the hazardous response teams so they'll go and save people from water and maybe with fires as well.  They've got... they’re specially trained in different things so there's the contingency sort of there.  So from a Control perspective, they look at... they look at it at least twice a week to see what the... what it... how busy it is.  And then they staff... they… they’re looking to staff to the worst level, knowing that they will get some people... there will be some abstractions.  So they won't manage to... to manage that, because their key area [inaudible].  Excuse me, they try to answer within the... the phone within three seconds 95% of the time.  I'm not sure exactly.  It's something like that.  That’s very high up there.  That's what they're trying to do.  So... and because I got it broken down at the Control level, so we've got North Wales level for calls, and we've also got it broken down by the North, the Mid, and the South Control.  It's actually called the North, the South East, and Central and West.  Those are the three control areas.  So they can see how those break down, knowing that at the moment we've got particularly high demand in the South East, and it's forecast to be just bonkers

# Experimental set {#design}


# Result and discussion {#result}


# Conclusion {#conclusion}



# References {#references .unnumbered}
